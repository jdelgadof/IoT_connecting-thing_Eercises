//
// Created by Jeferson on 10/04/2024.
//
#include <stdio.h>
#include "pico/stdlib.h"
#include "uart/PicoUart.h"
#include "display/ssd1306.h"
#include <time.h>
#include <iostream>
#include <sstream>

#define LED1 20
#define LED2 21
#define LED3 22
static const unsigned char Dino[] = {
        // font edit begin : monovlsb : 39 : 39 : 39
        0xFF, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
        0x01, 0x01, 0x01, 0xF9, 0xFE, 0xFE, 0xC6, 0xC6,
        0xC6, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE,
        0xFE, 0xFE, 0xFD, 0xF9, 0x01, 0x01, 0xFF, 0x3F,
        0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0xC0, 0xC0, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0x3F, 0x3F, 0x33, 0x33, 0x33, 0x33, 0x13, 0x03,
        0x03, 0x03, 0x03, 0x00, 0x00, 0xFF, 0x00, 0xFF,
        0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0xE0, 0xE0, 0xE0,
        0xF0, 0xF8, 0xFC, 0xFC, 0xFF, 0xFF, 0xFF, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x06,
        0x06, 0x0E, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00,
        0x03, 0x03, 0x0F, 0x1F, 0x1F, 0x7F, 0x7F, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x7F, 0xFF, 0xFF,
        0xFF, 0x1F, 0x1F, 0x0F, 0x01, 0x01, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0xFF, 0x7F, 0x40, 0x40, 0x40,
        0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7F, 0x67,
        0x63, 0x41, 0x40, 0x40, 0x40, 0x41, 0x41, 0x7F,
        0x60, 0x60, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40,
        0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0xC0, 0x40,
        0x40, 0x40, 0x7F
        // font edit end
};
int main() {

    // Initialize LED pin
    gpio_init(LED1);
    gpio_init(LED2);
    gpio_init(LED3);
    gpio_set_dir(LED1, 1);
    gpio_set_dir(LED2, 1);
    gpio_set_dir(LED3, 1);
    i2c_init(i2c1, 400 * 1000);
    gpio_set_function(14, GPIO_FUNC_I2C); // the display has external pull-ups
    gpio_set_function(15, GPIO_FUNC_I2C); // the display has external pull-ups

    ssd1306 display (i2c1);
    display.fill(0);
    mono_vlsb rb(Dino, 39, 39);
    display.blit(rb, 2, 20);
    display.show();
    // Initialize chosen serial port
    stdio_init_all();
    int counter = 0;
    long long current_time = time(nullptr);  // Get current time in seconds since epoch

    // Loop forever
    while (true) {

        std::string formatted_time = "Time: " + std::to_string(current_time) + "s";;
        // Display formatted time
        display.text(formatted_time.c_str(), 2, 2, 1);
        display.show();
        printf("%lld seconds\n", current_time);
        //printf("counter= %d\n",counter);
        printf("LED1 value= %d\n",(counter & 0b001));
        printf("LED2 value= %d\n",(counter & 0b010) >> 1);
        printf("LED3 value= %d\n",(counter & 0b100) >> 2);
        gpio_put(LED1, (counter & 0b001)); // Turn LED D1 on/off
        gpio_put(LED2, (counter & 0b010) >> 1); // Turn LED D2 on/off
        gpio_put(LED3, (counter & 0b100) >> 2); // Turn LED D3 on/off

        sleep_ms(125); // Wait for 1/4 second
        counter ++;
        current_time = time(nullptr);
        if(counter>7){counter = 0;}
        display.rect(42,2,30,12,0, true);
    }
}